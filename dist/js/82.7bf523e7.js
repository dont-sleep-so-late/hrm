"use strict";(self["webpackChunkGDUOHRM"]=self["webpackChunkGDUOHRM"]||[]).push([[82],{8082:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"OrganManage"},[t("el-card",[t("el-row",{attrs:{type:"flex",justify:"space-between"}},[t("el-form",{staticClass:"demo-form-inline",attrs:{size:"small",inline:""}},[t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addDialogVisible=!0}}},[e._v("添加一级机构")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addCateDialogVisibletwo=!0}}},[e._v("添加二级机构")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addCateDialogVisiblethree=!0}}},[e._v("添加三级机构")])],1)],1)],1),t("el-table",{ref:"table",attrs:{data:e.userlist,border:""}},[t("el-table-column",{attrs:{type:"index",label:"编号",width:"100","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"o1_name",label:"一级机构","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"o2_name",label:"二级机构","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"o3_name",label:"三级机构","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.removeUserById(a.row.id)}}})]}}])})],1),t("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[5,10,20,50],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChanged,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"添加一级机构",visible:e.addDialogVisible,width:"50%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[t("el-form",{ref:"addFormRef",attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"110px"}},[t("el-form-item",{attrs:{label:"一级机构名称",prop:"username"}},[t("el-input",{model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加二级机构",visible:e.addCateDialogVisibletwo,width:"50%"},on:{"update:visible":function(t){e.addCateDialogVisibletwo=t}}},[t("el-form",{ref:"addCateFormRef",attrs:{model:e.addCateForm,rules:e.addCateFormRules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"二级机构名称",prop:"cat_name"}},[t("el-input",{model:{value:e.addCateForm.cat_name,callback:function(t){e.$set(e.addCateForm,"cat_name",t)},expression:"addCateForm.cat_name"}})],1),t("el-form-item",{attrs:{label:"所属一级机构名称"}},[t("el-cascader",{attrs:{options:e.parentCateList,props:e.cascaderProps,clearable:"","change-on-select":""},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addCateDialogVisibletwo=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addCate}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加三级机构",visible:e.addCateDialogVisiblethree,width:"50%"},on:{"update:visible":function(t){e.addCateDialogVisiblethree=t}}},[t("el-form",{ref:"addCateFormRef",attrs:{model:e.addCateFormthree,rules:e.addCateFormRules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"三级机构名称",prop:"cat_name"}},[t("el-input",{model:{value:e.addCateFormthree.cat_name,callback:function(t){e.$set(e.addCateFormthree,"cat_name",t)},expression:"addCateFormthree.cat_name"}})],1),t("el-form-item",{attrs:{label:"所属一级机构名称"}},[t("el-cascader",{attrs:{options:e.parentCateList,props:e.cascaderProps,clearable:"","change-on-select":""},on:{change:e.parentCateChangedtwo},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1),t("el-form-item",{attrs:{label:"所属二级机构名称"}},[t("el-cascader",{attrs:{options:e.parentCateListthree,props:e.cascaderPropsthree,clearable:"","change-on-select":""},model:{value:e.selectedKeysthree,callback:function(t){e.selectedKeysthree=t},expression:"selectedKeysthree"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addCateDialogVisiblethree=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addCatethree}},[e._v("确 定")])],1)],1)],1)},i=[],r={name:"OrganManage",data(){return{addCateForm:{cat_name:"",cat_pid:0,cat_level:0},addCateFormthree:{cat_name:"",cat_pid:0,cat_level:0},addCateFormRules:{cat_name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},queryInfo:{query:"",pagenum:1,pagesize:10},userlist:[],total:0,addDialogVisible:!1,addForm:{username:"",password:"",email:"",mobile:""},addFormRules:{username:[{required:!0,message:"请输入一级机构名称",trigger:"blur"},{min:3,max:10,message:"用户名的长度在3~10个字符之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:15,message:"用户名的长度在6~15个字符之间",trigger:"blur"}]},editDialogVisible:!1,addCateDialogVisiblethree:!1,addCateDialogVisibletwo:!1,editForm:{},setRolesDialogVisible:!1,userInfo:{},rolesList:[],selectedRoleId:"",parentCateList:[],cascaderProps:{value:"o1_id",label:"o1_name",children:"children",expandTrigger:"hover"},selectedKeys:"",parentCateListthree:[],cascaderPropsthree:{value:"o2_id",label:"o2_name",children:"children",expandTrigger:"hover"},selectedKeysthree:""}},methods:{async parentCateChangedtwo(){console.log(555);const{data:e}=await this.$http.post(`/Sys/organ/queryOrgan2/${this.selectedKeys}`);this.parentCateListthree=e.data},async getOrganList(){this.queryInfo.pagenum=0;const{data:e}=await this.$http.post(`/Sys/organ/queryAllOrganization/${this.queryInfo.pagenum}/${this.queryInfo.pagesize}`);this.userlist=e.data,this.total=0,e.data.forEach((()=>{this.total++}));const{data:t}=await this.$http.post("/Sys/organ/queryOrgan1");this.parentCateList=t.data},addCate(){this.$refs.addCateFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.post(`/Sys/organ/insertOrgan2?o1Id=${this.selectedKeys}&o2Name=${this.addCateForm.cat_name}`);this.$message.success("添加分类成功！"),this.addCateDialogVisibletwo=!1}))},addCatethree(){this.$refs.addCateFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.post(`/Sys/organ/insertOrgan3?o2Id=${this.selectedKeysthree}&o3Name=${this.addCateFormthree.cat_name}`);this.$message.success("添加分类成功！"),this.addCateDialogVisiblethree=!1}))},async getParentCateList(){const{data:e}=await this.$http.post("/Sys/organ/queryOrgan1");this.parentCateList=e.data,this.parentCateListthree=res2.data},async getUserListByName(){this.queryInfo.pagenum=0;const{data:e}=await this.$http.post(`/Sys/organ/queryOrganizationByName/${this.queryInfo.query}/${this.queryInfo.pagenum}/${this.queryInfo.pagesize}`);console.log(e.data),this.userlist=e.data,this.total=8},handleSizeChanged(e){this.queryInfo.pagesize=e,this.getOrganList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getOrganList()},async userStateChanged(e){const{data:t}=await this.$http.put(`users/${e.id}/state/${e.mg_state}`);if(200!==t.meta.status)return e.mg_state=!e.mg_state,this.$message.error("更新用户状态失败！");this.$message.success("更新用户状态成功！")},addDialogClosed(){this.$refs.addFormRef.resetFields()},addUser(){this.$refs.addFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.post(`/Sys/organ/insertOrgan1?o1Name=${this.addForm.username}`);this.$message.success("添加用户成功!"),this.addDialogVisible=!1,this.getOrganList()}))},async showEditDialog(e){this.editDialogVisible=!0;const{data:t}=await this.$http.post("users/"+e);if(200!==t.meta.status)return this.$message.error("查询用户信息失败！");this.editForm=t.data},editDialogClosed(){this.$refs.editFormRef.resetFields()},editUserInfo(){this.$refs.editFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.put("users/"+this.editForm.id,{email:this.editForm.email,mobile:this.editForm.mobile});if(200!==t.meta.status)return this.$message.error("更新用户信息失败！");this.editDialogVisible=!1,this.getOrganList(),this.$message.success("更新用户信息成功！")}))},async removeUserById(e){const t=await this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("confirm"!==t)return this.$message.info("已取消删除");const{data:a}=await this.$http.post(`/Sys/organ/deleteOrgan3/${e}`);this.$message.success("删除用户成功！"),this.getOrganList()},async setRole(e){this.userInfo=e;const{data:t}=await this.$http.get("roles");if(200!==t.meta.status)return this.$message.error("获取角色列表失败！");this.rolesList=t.data,this.setRolesDialogVisible=!0},async saveRoleInfo(){if(!this.selectedRoleId)return this.$message.error("请选择要分配的角色!");const{data:e}=await this.$http.put(`users/${this.userInfo.id}/role`,{rid:this.selectedRoleId});if(200!==e.meta.status)return this.$message.error("更新角色失败！");this.$message.success("更新角色成功！"),this.getOrganList(),this.setRolesDialogVisible=!1},setRoleDialogClosed(){this.selectedRoleId="",this.userInfo={}}},created(){},mounted(){this.getOrganList()}},o=r,l=a(1001),n=(0,l.Z)(o,s,i,!1,null,"100fd222",null),d=n.exports}}]);
//# sourceMappingURL=82.7bf523e7.js.map